// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "mongodb"
    url      = env("DATABASE_URL")
}

// Necessary for Next auth
model Account {
    id                String  @id @default(auto()) @map("_id") @db.ObjectId
    userId            String  @db.ObjectId
    type              String
    provider          String
    providerAccountId String
    refresh_token     String? @db.String
    access_token      String? @db.String
    expires_at        Int?
    token_type        String?
    scope             String?
    id_token          String? @db.String
    session_state     String?
    user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@unique([provider, providerAccountId])
    @@index([userId])
}

model Session {
    id           String   @id @default(auto()) @map("_id") @db.ObjectId
    sessionToken String   @unique
    userId       String   @db.ObjectId
    expires      DateTime
    user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@index([userId])
}

enum UserRoles {
    Admin
    Teacher
    Tester
    Student
    SalesAgent
    OperationAgent
    ChatAgent
}

enum UserScreen {
    dashboard
    operations_management
    notes
    groups
    trainee_lists
    placement_tests
    sessions
    sales_management
    orders
    leads
    users_management
    students
    ops_team
    edu_team
    chat_agents
    account
    system_management
    config
    content
    products
    privacy
    terms
    documentation
    support
    tickets
}

enum CourseStatuses {
    OrderCreated
    OrderPaid
    PlacementTest
    Waiting
    Ongoing
    Completed
    Cancelled
    Refunded
    Postponded
}

enum Devices {
    Mobile
    Tablet
    Desktop
}

model CourseStatus {
    id            String         @id @default(auto()) @map("_id") @db.ObjectId
    course        Course         @relation(fields: [courseId], references: [id], onDelete: Cascade)
    courseId      String         @db.ObjectId
    order         Order          @relation(fields: [orderId], references: [id])
    orderId       String         @db.ObjectId
    level         CourseLevel?   @relation(fields: [courseLevelId], references: [id], onDelete: Cascade)
    courseLevelId String?        @db.ObjectId
    user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
    userId        String         @db.ObjectId
    status        CourseStatuses
    isPrivate     Boolean?
    updatedAt     DateTime       @updatedAt
    createdAt     DateTime       @default(now())
}

model User {
    id                    String                 @id @default(auto()) @map("_id") @db.ObjectId
    name                  String
    email                 String                 @unique
    emailVerified         DateTime?
    image                 String?
    hashedPassword        String?
    tempPassword          String?
    phone                 String                 @unique
    userRoles             UserRoles[]            @default([Student])
    userScreens           UserScreen[]
    accounts              Account[]
    sessions              Session[]
    orders                Order[]
    payments              Payment[]
    refunds               Refund[]
    courseStatus          CourseStatus[]
    certificates          Certificate[]
    supportTicket         SupportTicket[]
    leads                 Lead[]
    leadInteractions      LeadInteraction[]
    systemFormSubmissions SystemFormSubmission[]
    placementTests        PlacementTest[]        @relation("PlacementTestToStudent")
    createdPlacementTests PlacementTest[]        @relation("PlacementTestToCreatedBy")
    studentNotes          UserNote[]             @relation("CreatedForStudent")
    userNotes             UserNote[]             @relation("CreatedByUser")
    userNoteMention       UserNote[]             @relation("MentionedUser", fields: [userNoteId], references: [id])
    userNoteId            String[]               @db.ObjectId
    zoomGroups            ZoomGroup[]            @relation("UserToGroup", fields: [zoomGroupIds], references: [id])
    zoomGroupIds          String[]               @db.ObjectId
    teacher               Teacher?               @relation("UserToTeacher")
    teacherId             String?                @db.ObjectId
    tester                Tester?                @relation("UserToTester")
    testerId              String?                @db.ObjectId
    SalesAgent            SalesAgent?            @relation("UserToSalesAgent")
    salesAgentId          String?                @db.ObjectId
    chatAgent             ChatAgent?             @relation("UserToChatAgent")
    supportChat           SupportChat?           @relation("UserToChat")
    address               Address?
    device                Devices?
    updatedAt             DateTime               @updatedAt
    createdAt             DateTime               @default(now())
}

model VerificationToken {
    id         String   @id @default(auto()) @map("_id") @db.ObjectId
    identifier String
    token      String   @unique
    expires    DateTime

    @@unique([identifier, token])
}

model PlacementTest {
    id              String        @id @default(auto()) @map("_id") @db.ObjectId
    student         User          @relation("PlacementTestToStudent", fields: [studentUserId], references: [id], onDelete: Cascade)
    studentUserId   String        @db.ObjectId
    course          Course        @relation(fields: [courseId], references: [id], onDelete: Cascade)
    courseId        String        @db.ObjectId
    writtenTest     SystemForm    @relation(fields: [writtenTestId], references: [id], onDelete: Cascade)
    writtenTestId   String        @db.ObjectId
    oralFeedback    String?
    oralTestTime    DateTime
    zoomSessions    ZoomSession[]
    tester          Tester        @relation(fields: [testerId], references: [id], onDelete: Cascade)
    testerId        String        @db.ObjectId
    createdBy       User?         @relation("PlacementTestToCreatedBy", fields: [createdByUserId], references: [id])
    createdByUserId String?       @db.ObjectId
    updatedAt       DateTime      @updatedAt
    createdAt       DateTime      @default(now())
}

model Teacher {
    id           String        @id @default(auto()) @map("_id") @db.ObjectId
    groups       ZoomGroup[]
    zoomSessions ZoomSession[]
    user         User          @relation("UserToTeacher", fields: [userId], references: [id], onDelete: Cascade)
    userId       String        @unique @db.ObjectId
    updatedAt    DateTime      @updatedAt
    createdAt    DateTime      @default(now())
}

model Tester {
    id            String          @id @default(auto()) @map("_id") @db.ObjectId
    assignedTests PlacementTest[]
    user          User            @relation("UserToTester", fields: [userId], references: [id], onDelete: Cascade)
    userId        String          @unique @db.ObjectId
    updatedAt     DateTime        @updatedAt
    createdAt     DateTime        @default(now())
}

model CourseLevel {
    id            String         @id @default(auto()) @map("_id") @db.ObjectId
    name          String
    slug          String
    course        Course         @relation(fields: [courseId], references: [id], onDelete: Cascade)
    courseId      String         @db.ObjectId
    systemForms   SystemForm[]
    zoomGroups    ZoomGroup[]
    certificates  Certificate[]
    courseStatus  CourseStatus[]
    materialItems MaterialItem[]
    productItems  ProductItem[]
    updatedAt     DateTime       @updatedAt
    createdAt     DateTime       @default(now())

    @@unique([courseId, slug])
}

model Course {
    id              String          @id @default(auto()) @map("_id") @db.ObjectId
    name            String
    slug            String          @unique
    description     String?
    image           String?
    groupPrice      Float
    privatePrice    Float
    instructorPrice Float
    levels          CourseLevel[]
    placementTests  PlacementTest[]
    zoomGroups      ZoomGroup[]
    systemForms     SystemForm[]
    certificates    Certificate[]
    courseStatus    CourseStatus[]
    orders          Order[]
    productItems    ProductItem[]
    updatedAt       DateTime        @updatedAt
    createdAt       DateTime        @default(now())
}

type MaterialItemManual {
    leadinText        String
    leadinImageUrl    String
    firstTestTitle    String
    answerCards       AnswerCard[]
    answerAreas       AnswerArea[]
    vocabularyCards   VocabCard[]
    practiceQuestions Question[]
}

enum MaterialItemType {
    Manual
    Upload
}

model MaterialItem {
    id            String              @id @default(auto()) @map("_id") @db.ObjectId
    title         String
    subTitle      String?
    slug          String
    sessionOrder  Int
    type          MaterialItemType
    uploads       String[]
    manual        MaterialItemManual?
    systemForms   SystemForm[]
    zoomSessions  ZoomSession[]
    courseLevel   CourseLevel?        @relation(fields: [courseLevelId], references: [id], onDelete: Cascade)
    courseLevelId String?             @db.ObjectId
    updatedAt     DateTime            @updatedAt
    createdAt     DateTime            @default(now())

    @@unique([courseLevelId, slug])
}

type Question {
    id            String
    type          QuestionType
    question      String
    choices       String[]
    correctAnswer String
    studentAnswer String
}

enum QuestionType {
    ControlledPracticeMultichoiceQuestion
    ControlledPracticeFillTheGapQuestion
    ControlledPracticeQuestion
}

type VocabCard {
    word    String
    context String
    example String
    images  Images
}

type Images {
    front String
    back  String
}

type AnswerArea {
    img           String
    card          AnswerCard?
    correctAnswer String
}

type AnswerCard {
    id   String
    text String
}

enum OrderStatus {
    Pending
    Paid
    Cancelled
    Refunded
}

type CourseType {
    id        String
    isPrivate Boolean
}

model Order {
    id              String         @id @default(auto()) @map("_id") @db.ObjectId
    orderNumber     String         @unique
    amount          Float
    payments        Payment[]
    refunds         Refund[]
    courseStatuses  CourseStatus[]
    status          OrderStatus    @default(Pending)
    course          Course?        @relation(fields: [courseId], references: [id])
    courseId        String?        @db.ObjectId
    product         Product?       @relation(fields: [productId], references: [id])
    productId       String?        @db.ObjectId
    courseType      CourseType?
    refundRequester String?        @db.ObjectId
    paymentIntentId String?
    paymentLink     String?
    lead            Lead           @relation(fields: [leadId], references: [id])
    leadId          String         @db.ObjectId
    user            User           @relation(fields: [userId], references: [id], onDelete: Cascade)
    userId          String         @db.ObjectId
    updatedAt       DateTime       @updatedAt
    createdAt       DateTime       @default(now())
}

model Payment {
    id            String     @id @default(auto()) @map("_id") @db.ObjectId
    paymentId     String?
    paymentProof  String?
    paymentAmount Int
    order         Order      @relation(fields: [orderId], references: [id])
    orderId       String     @db.ObjectId
    user          User       @relation(fields: [userId], references: [id])
    userId        String     @db.ObjectId
    agent         SalesAgent @relation(fields: [agentId], references: [id])
    agentId       String     @db.ObjectId
    updatedAt     DateTime   @updatedAt
    createdAt     DateTime   @default(now())
}

model Refund {
    id           String     @id @default(auto()) @map("_id") @db.ObjectId
    refundId     String?
    refundProof  String?
    refundAmount Int
    order        Order      @relation(fields: [orderId], references: [id])
    orderId      String     @db.ObjectId
    user         User       @relation(fields: [userId], references: [id])
    userId       String     @db.ObjectId
    agent        SalesAgent @relation(fields: [agentId], references: [id])
    agentId      String     @db.ObjectId
    updatedAt    DateTime   @updatedAt
    createdAt    DateTime   @default(now())
}

type Address {
    city    String?
    country String?
    state   String?
    street  String?
}

model SalesAgent {
    id               String            @id @default(auto()) @map("_id") @db.ObjectId
    leads            Lead[]
    leadInteractions LeadInteraction[]
    payments         Payment[]
    refunds          Refund[]
    user             User              @relation("UserToSalesAgent", fields: [userId], references: [id], onDelete: Cascade)
    userId           String            @unique @db.ObjectId
    updatedAt        DateTime          @updatedAt
    createdAt        DateTime          @default(now())
}

type Reminder {
    title String
    time  DateTime
}

enum LeadSource {
    Facebook
    Instagram
    WhatsApp
    Manual
    Other
}

model LeadLabel {
    id        String   @id @default(auto()) @map("_id") @db.ObjectId
    value     String   @unique
    leads     Lead[]   @relation("LabelToLead", fields: [leadIds], references: [id])
    leadIds   String[] @db.ObjectId
    updatedAt DateTime @updatedAt
    createdAt DateTime @default(now())
}

model LeadNote {
    id        String   @id @default(auto()) @map("_id") @db.ObjectId
    value     String
    leads     Lead[]   @relation("NoteToLead", fields: [leadIds], references: [id])
    leadIds   String[] @db.ObjectId
    updatedAt DateTime @updatedAt
    createdAt DateTime @default(now())
}

enum LeadInteractionType {
    Call
    Chat
    Meeting
}

model LeadInteraction {
    id           String              @id @default(auto()) @map("_id") @db.ObjectId
    description  String
    type         LeadInteractionType
    lead         Lead?               @relation(fields: [leadId], references: [id])
    leadId       String?             @db.ObjectId
    salesAgent   SalesAgent?         @relation(fields: [salesAgentId], references: [id])
    salesAgentId String?             @db.ObjectId
    customer     User?               @relation(fields: [userId], references: [id])
    userId       String?             @db.ObjectId
    updatedAt    DateTime            @updatedAt
    createdAt    DateTime            @default(now())
}

model Lead {
    id             String            @id @default(auto()) @map("_id") @db.ObjectId
    code           String            @unique
    metaUserId     String?
    conversationId String?
    name           String?
    email          String?
    phone          String?
    message        String?
    image          String?
    isAutomated    Boolean
    source         LeadSource
    formId         String?
    isReminderSet  Boolean
    reminders      Reminder[]
    interactions   LeadInteraction[]
    interactionIds String[]          @db.ObjectId
    labels         LeadLabel[]       @relation("LabelToLead", fields: [labelIds], references: [id])
    labelIds       String[]          @db.ObjectId
    notes          LeadNote[]        @relation("NoteToLead", fields: [noteIds], references: [id])
    noteIds        String[]          @db.ObjectId
    orders         Order[]
    isAssigned     Boolean
    isInvalid      Boolean?
    assignee       SalesAgent?       @relation(fields: [assigneeId], references: [id])
    assigneeId     String?           @db.ObjectId
    user           User?             @relation(fields: [userId], references: [id])
    userId         String?           @db.ObjectId
    leadStage      LeadStage?        @relation(fields: [leadStageId], references: [id])
    leadStageId    String?           @db.ObjectId
    updatedAt      DateTime          @updatedAt
    createdAt      DateTime          @default(now())
}

enum DefaultStage {
    Intake
    Qualified
    Converted
    NotQualified
    Lost
}

model LeadStage {
    id           String        @id @default(auto()) @map("_id") @db.ObjectId
    name         String        @unique
    order        Int
    leads        Lead[]
    defaultStage DefaultStage? @unique
    updatedAt    DateTime      @updatedAt
    createdAt    DateTime      @default(now())
}

model Message {
    id            String       @id @default(auto()) @map("_id") @db.ObjectId
    text          String
    sender        String
    supportChat   SupportChat? @relation(fields: [supportChatId], references: [id], onDelete: Cascade)
    supportChatId String?      @db.ObjectId
    updatedAt     DateTime     @updatedAt
    createdAt     DateTime     @default(now())
}

model SupportChat {
    id        String     @id @default(auto()) @map("_id") @db.ObjectId
    user      User?      @relation("UserToChat", fields: [userId], references: [id], onDelete: Cascade)
    userId    String?    @unique @db.ObjectId
    agent     ChatAgent? @relation(fields: [agentId], references: [id], onDelete: SetNull)
    agentId   String?    @db.ObjectId
    messages  Message[]
    updatedAt DateTime   @updatedAt
    createdAt DateTime   @default(now())
}

model ChatAgent {
    id        String        @id @default(auto()) @map("_id") @db.ObjectId
    chats     SupportChat[]
    user      User          @relation("UserToChatAgent", fields: [userId], references: [id], onDelete: Cascade)
    userId    String        @unique @db.ObjectId
    updatedAt DateTime      @updatedAt
    createdAt DateTime      @default(now())
}

enum SessionStatus {
    Scheduled
    Starting
    Ongoing
    Completed
    Cancelled
}

type SubmissionAnswer {
    text       String?
    isTrue     Boolean?
    questionId String   @db.ObjectId
}

model ZoomSession {
    id              String                 @id @default(auto()) @map("_id") @db.ObjectId
    sessionDate     DateTime
    meetingNumber   String
    meetingPassword String
    sessionStatus   SessionStatus
    teacher         Teacher?               @relation(fields: [teacherId], references: [id])
    teacherId       String?                @db.ObjectId
    zoomGroup       ZoomGroup?             @relation(fields: [groupId], references: [id], onDelete: Cascade)
    groupId         String?                @db.ObjectId
    materialItem    MaterialItem?          @relation(fields: [materialItemId], references: [id], onDelete: Cascade)
    materialItemId  String?                @db.ObjectId
    placementTest   PlacementTest?         @relation(fields: [placementTestId], references: [id], onDelete: Cascade)
    placementTestId String?                @db.ObjectId
    zoomClient      ZoomClient?            @relation(fields: [zoomClientId], references: [id], onDelete: Cascade)
    zoomClientId    String?                @db.ObjectId
    attenders       String[]
    assignments     SystemFormSubmission[] @relation("Assignments")
    quizzes         SystemFormSubmission[] @relation("Quizzes")
    updatedAt       DateTime               @updatedAt
    createdAt       DateTime               @default(now())
}

enum GroupStatus {
    Waiting
    Active
    Inactive
    Paused
    Cancelled
    Completed
}

model ZoomGroup {
    id              String                 @id @default(auto()) @map("_id") @db.ObjectId
    groupNumber     String
    startDate       DateTime
    meetingNumber   String
    meetingPassword String
    groupStatus     GroupStatus
    teacher         Teacher?               @relation(fields: [teacherId], references: [id], onDelete: SetNull)
    teacherId       String?                @db.ObjectId
    students        User[]                 @relation("UserToGroup", fields: [studentIds], references: [id])
    studentIds      String[]               @db.ObjectId
    course          Course?                @relation(fields: [courseId], references: [id], onDelete: SetNull)
    courseId        String?                @db.ObjectId
    courseLevel     CourseLevel?           @relation(fields: [courseLevelId], references: [id], onDelete: SetNull)
    courseLevelId   String?                @db.ObjectId
    zoomSessions    ZoomSession[]
    finalTests      SystemFormSubmission[]
    updatedAt       DateTime               @updatedAt
    createdAt       DateTime               @default(now())
}

model ZoomClient {
    id              String        @id @default(auto()) @map("_id") @db.ObjectId
    name            String
    encodedIdSecret String
    accessToken     String
    refreshToken    String
    isZoom          Boolean
    roomCode        String?
    zoomSessions    ZoomSession[]
    updatedAt       DateTime      @updatedAt
    createdAt       DateTime      @default(now())
}

model GoogleClient {
    id           String       @id @default(auto()) @map("_id") @db.ObjectId
    name         String
    accessToken  String?
    expiryDate   Int?
    refreshToken String?
    idToken      String?
    scope        String?
    systemForms  SystemForm[]
    updatedAt    DateTime     @updatedAt
    createdAt    DateTime     @default(now())
}

model MetaClient {
    id          String   @id @default(auto()) @map("_id") @db.ObjectId
    name        String
    accessToken String
    updatedAt   DateTime @updatedAt
    createdAt   DateTime @default(now())
}

type NoteUpdate {
    message   String
    updatedBy String
    updatedAt DateTime
}

enum UserNoteTypes {
    Info
    Query
    ComplainLevel1
    ComplainLevel2
    ComplainLevel3
    Followup
    Feedback
}

enum UserNoteStatus {
    Created
    Opened
    Closed
}

model UserNote {
    id                  String         @id @default(auto()) @map("_id") @db.ObjectId
    title               String
    messages            NoteUpdate[]
    sla                 Int
    type                UserNoteTypes
    status              UserNoteStatus
    mentions            User[]         @relation("MentionedUser", references: [id], fields: [mentionsUserIds])
    mentionsUserIds     String[]       @db.ObjectId
    createdByUser       User           @relation("CreatedByUser", fields: [createdByUserId], references: [id], onDelete: Cascade)
    createdByUserId     String         @db.ObjectId
    createdForStudent   User           @relation("CreatedForStudent", fields: [createdForStudentId], references: [id], onDelete: Cascade)
    createdForStudentId String         @db.ObjectId
    updatedAt           DateTime       @updatedAt
    createdAt           DateTime       @default(now())
}

model Certificate {
    id             String       @id @default(auto()) @map("_id") @db.ObjectId
    user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
    userId         String       @db.ObjectId
    course         Course       @relation(fields: [courseId], references: [id])
    courseId       String       @db.ObjectId
    certificateId  String
    courseLevel    CourseLevel? @relation(fields: [courseLevelId], references: [id])
    courseLevelId  String?      @db.ObjectId
    completionDate DateTime
    updatedAt      DateTime     @updatedAt
    createdAt      DateTime     @default(now())
}

model SiteIdentity {
    id             String   @id @default(auto()) @map("_id") @db.ObjectId
    name1          String   @default("Gateling")
    name2          String   @default("TMS")
    heroText       String   @default("Dive into a world of English language excellence with Gateling TMS. Elevate your\nlanguage skills and unlock new opportunities. Join us in the journey of learning \nwhere every lesson takes you a step closer to linguistic mastery.")
    logoPrimary    String   @default("/logos/logoPrimary.png")
    logoAccent     String   @default("/logos/logoAccent.png")
    logoForeground String   @default("/logos/logoForeground.png")
    facebook       String   @default("https://www.facebook.com/gatelingsolutions")
    instagram      String   @default("https://www.instagram.com/gatelingsolutions")
    youtube        String   @default("https://www.youtube.com/gatelingsolutions")
    linkedin       String   @default("https://www.linkedin.com/in/mohamed-magdy-fayed/")
    updatedAt      DateTime @updatedAt
    createdAt      DateTime @default(now())
}

model license_key {
    id  String @id @default(auto()) @map("_id") @db.ObjectId
    key String
}

enum SupportTicketStatus {
    Created
    Opened
    Closed
}

type SupportTicketMessage {
    userName    String
    userEmail   String
    messageText String
    messageDate DateTime
}

model SupportTicket {
    id              String                 @id @default(auto()) @map("_id") @db.ObjectId
    subject         String
    info            String
    status          SupportTicketStatus
    messages        SupportTicketMessage[]
    createdBy       User                   @relation(fields: [createdByUserId], references: [id])
    createdByUserId String                 @db.ObjectId
    updatedAt       DateTime               @updatedAt
    createdAt       DateTime               @default(now())
}

enum MessageTemplateType {
    Welcome
    ConfirmEmail
    EmailConfirmed
    CredentialsEmail
    OrderPlaced
    OrderPaid
    OrderCancelled
    OrderRefunded
    PlacementTestScheduled
    PlacementTestRescheduled
    AddedToWaitingList
    AddedToGroup
    SessionStartingSoon
    SessionStarted
    SessionUpdated
    SessionCompleted
    GroupCompleted
    CertificateReady
    Custom
}

model MessageTemplate {
    id           String              @id @default(auto()) @map("_id") @db.ObjectId
    name         String              @unique
    type         MessageTemplateType
    body         String
    placeholders String[]
    updatedAt    DateTime            @updatedAt
    createdAt    DateTime            @default(now())
}

model Parameters {
    id      String @id @default(auto()) @map("_id") @db.ObjectId
    number  Int    @unique
    name    String
    altName String
    value   String

    updatedBy String
    updatedAt DateTime @updatedAt
    createdAt DateTime @default(now())
}

enum SystemFormTypes {
    Assignment
    Quiz
    FinalTest
    PlacementTest
}

model SystemForm {
    id                String          @id @default(auto()) @map("_id") @db.ObjectId
    title             String
    description       String
    totalScore        Int
    googleFormUrl     String?
    oralTestQuestions String?
    type              SystemFormTypes

    googleClient   GoogleClient?          @relation(fields: [courseId], references: [id], onDelete: Cascade)
    googleClientId String?                @db.ObjectId
    course         Course?                @relation(fields: [courseId], references: [id], onDelete: Cascade)
    courseId       String?                @db.ObjectId
    courseLevel    CourseLevel?           @relation(fields: [courseLevelId], references: [id], onDelete: Cascade)
    courseLevelId  String?                @db.ObjectId
    materialItem   MaterialItem?          @relation(fields: [materialItemId], references: [id])
    materialItemId String?                @db.ObjectId
    items          SystemFormItem[]
    submissions    SystemFormSubmission[]
    placementTest  PlacementTest[]

    updatedBy String
    updatedAt DateTime @updatedAt
    createdBy String
    createdAt DateTime @default(now())
}

enum ItemType {
    QuestionItem
    QuestionGroupItem
    PageBreakItem
    TextItem
    ImageItem
    VideoItem
}

model SystemFormItem {
    id       String   @id @default(auto()) @map("_id") @db.ObjectId
    type     ItemType
    title    String?
    imageUrl String?
    altText  String?
    videoUrl String?
    caption  String?

    questions    ItemQuestion[]
    systemForm   SystemForm     @relation(fields: [systemFormId], references: [id], onDelete: Cascade)
    systemFormId String         @db.ObjectId

    updatedAt DateTime @updatedAt
    createdAt DateTime @default(now())
}

enum ItemQuestionType {
    Choice
    Text
}

enum QuestionChoiceType {
    Radio
    Checkbox
}

model ItemQuestionOption {
    id        String  @id @default(auto()) @map("_id") @db.ObjectId
    value     String
    isCorrect Boolean

    itemQuestion   ItemQuestion @relation(fields: [itemQuestionId], references: [id], onDelete: Cascade)
    itemQuestionId String       @db.ObjectId
}

model ItemQuestion {
    id           String              @id @default(auto()) @map("_id") @db.ObjectId
    type         ItemQuestionType
    choiceType   QuestionChoiceType?
    required     Boolean
    questionText String
    points       Int
    shuffle      Boolean?

    options ItemQuestionOption[]
    item    SystemFormItem       @relation(fields: [itemId], references: [id], onDelete: Cascade)
    itemId  String               @db.ObjectId
}

type SystemFormSubmissionAnswer {
    questionId      String
    selectedAnswers String[]
    textAnswer      String?
    isCorrect       Boolean
}

model SystemFormSubmission {
    id String @id @default(auto()) @map("_id") @db.ObjectId

    answers      SystemFormSubmissionAnswer[]
    totalScore   Int
    oralFeedback String?

    student      User       @relation(fields: [studentId], references: [id], onDelete: Cascade)
    studentId    String     @db.ObjectId
    systemForm   SystemForm @relation(fields: [systemFormId], references: [id], onDelete: Cascade)
    systemFormId String     @db.ObjectId

    updatedAt               DateTime     @updatedAt
    createdAt               DateTime     @default(now())
    quizZoomSession         ZoomSession? @relation("Quizzes", fields: [quizZoomSessionId], references: [id])
    quizZoomSessionId       String?      @db.ObjectId
    assignmentZoomSession   ZoomSession? @relation("Assignments", fields: [assignmentZoomSessionId], references: [id])
    assignmentZoomSessionId String?      @db.ObjectId
    zoomGroup               ZoomGroup?   @relation(fields: [zoomGroupId], references: [id])
    zoomGroupId             String?      @db.ObjectId
}

model Product {
    id              String        @id @default(auto()) @map("_id") @db.ObjectId
    price           Int
    discountedPrice Int?
    name            String
    description     String?
    image           String?
    isActive        Boolean
    isPrivate       Boolean
    orders          Order[]
    productItems    ProductItem[]

    updatedAt DateTime @updatedAt
    createdAt DateTime @default(now())
}

model ProductItem {
    id            String       @id @default(auto()) @map("_id") @db.ObjectId
    product       Product      @relation(fields: [productId], references: [id])
    productId     String       @db.ObjectId
    course        Course       @relation(fields: [courseId], references: [id])
    courseId      String       @db.ObjectId
    level         CourseLevel? @relation(fields: [courseLevelId], references: [id])
    courseLevelId String?      @db.ObjectId

    updatedAt DateTime @updatedAt
    createdAt DateTime @default(now())

    @@unique([productId, courseId, courseLevelId])
}
